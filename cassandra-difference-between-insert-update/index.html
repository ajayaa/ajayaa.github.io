<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Difference between cassandra insert and update statement &#8211; while 1:<br></br>learn, sleep</title>
<meta name="description" content="cassandra-insert-update-ttl">
<meta name="keywords" content="cassandra, update, insert, ttl, inconsistent, time_to_live">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Difference between cassandra insert and update statement">
<meta name="twitter:description" content="cassandra-insert-update-ttl">
<meta name="twitter:site" content="@aj_agr">
<meta name="twitter:creator" content="@aj_agr">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ajayaa.github.io/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Difference between cassandra insert and update statement">
<meta property="og:description" content="cassandra-insert-update-ttl">
<meta property="og:url" content="http://ajayaa.github.io/cassandra-difference-between-insert-update/">
<meta property="og:site_name" content="while 1:<br></br>learn, sleep">





<link rel="canonical" href="http://ajayaa.github.io/cassandra-difference-between-insert-update/">
<link href="http://ajayaa.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="while 1:<br></br>learn, sleep Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://ajayaa.github.io/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://ajayaa.github.io/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://ajayaa.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://ajayaa.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://ajayaa.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://ajayaa.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://ajayaa.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://ajayaa.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://ajayaa.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://ajayaa.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://ajayaa.github.io">while 1:<br></br>learn, sleep</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
					    
					        
					    
					    <li><a href="http://ajayaa.github.io/about/" >About</a></li>
					  
					    
					        
					    
					    <li><a href="http://ajayaa.github.io/posts/" >Posts</a></li>
					  
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    



	<img src="http://ajayaa.github.io/images/bio-photo.jpg" class="bio-photo" alt="Ajaya bio photo">

<h3>Ajaya</h3>
<p>Software Engineer</p>
<a href="mailto:ajku.agr@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/aj_agr" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>





<a href="http://github.com/ajayaa" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>








  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://ajayaa.github.io/cassandra-difference-between-insert-update/" rel="bookmark" title="Difference between cassandra insert and update statement">Difference between cassandra insert and update statement</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>This post is about explaining one huge difference between cassandra update and insert and how things get hairy when you use ttl with a column.</p>

<h3 id="table-schema">Table schema</h3>
<p>Here is the cql statement to create the table.</p>

<figure>
<a href="/images/create_table.png"><img src="/images/create_table.png" /></a>
</figure>

<h3 id="normal-insert">Normal insert</h3>

<figure>
<a href="/images/insert_normal.png"><img src="/images/insert_normal.png" /></a>
</figure>

<p>so far so good.</p>

<h3 id="normal-update">Normal update</h3>

<figure>
<a href="/images/update_normal.png"><img src="/images/update_normal.png" /></a>
</figure>

<p>This is an update which behaves like normal insert.</p>

<h3 id="insert-and-update-with-a-null">insert and update with a null</h3>
<figure>
<a href="/images/insert_null.png"><img src="/images/insert_null.png" /></a>
</figure>

<figure>
<a href="/images/update_null.png"><img src="/images/update_null.png" /></a>
</figure>

<p>In the insert statement as we have mentioned a primary key but set a non-primary-key column to null a row should be inserted into the table. We did the similar thing with update statement. We should be able to verify this with a select statement.</p>

<figure>
<a href="/images/select_after_update_null.png"><img src="/images/select_after_update_null.png" /></a>
</figure>

<p>What happended here. There is no row corresponding to primary key ‘d’ which we used in update statement but there is one row corresponding to primary key ‘c’ which we used in insert statement. That is weird, right? Yes, it is. Apparently cassandra deletes a row if all of its non primary key fields are set to null if that row was inserted with a update statement.</p>

<h4 id="ttl">TTL</h4>
<p>When you insert ttl into picture things really get hairy and you would run into situations where you would think it’s a cassandra bug. But in reality it’s not. Many a times it’s been reported as a bug in cassandra but had to be explained to naive souls :). I was such a naive soul sometime back. See <a href="https://issues.apache.org/jira/browse/CASSANDRA-8430">8430</a> and <a href="https://issues.apache.org/jira/browse/CASSANDRA-6668">6668</a>. TTLs are on per column basis in cassandra and you need to be careful when using ttls with update statements. The lifetime of a row would also depend on whether the row was inserted with an insert or update statement. </p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          



	<img src="http://ajayaa.github.io/images/bio-photo.jpg" class="bio-photo" alt="Ajaya bio photo">

<h3>Ajaya</h3>
<p>Software Engineer</p>
<a href="mailto:ajku.agr@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/aj_agr" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>





<a href="http://github.com/ajayaa" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>








        </div>
        <p class="byline"><strong>Difference between cassandra insert and update statement</strong> was published on <time datetime="2015-01-14T00:00:00+05:30">January 14, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://ajayaa.github.io/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://ajayaa.github.io/neutron-multinode-devstack/" title="Devstack multinode with neutron and vagrant">Devstack multinode with neutron and vagrant</a></li>
    
      <li><a href="http://ajayaa.github.io/devstack/" title="Devstack">Devstack</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

<span>&copy; 2015 Ajaya. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> 

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://ajayaa.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://ajayaa.github.io/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-54050077-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ajayaagithubio'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


	        

</body>
</html>